# Guide des Registres x86_64 pour l'Assembleur

## ğŸ¯ Convention d'Appel System V (Linux/macOS)

### ğŸ“‹ Ordre des ParamÃ¨tres de Fonction
Les 6 premiers paramÃ¨tres sont passÃ©s dans ces registres (dans l'ordre) :

1. **RDI** â† Premier paramÃ¨tre
2. **RSI** â† DeuxiÃ¨me paramÃ¨tre  
3. **RDX** â† TroisiÃ¨me paramÃ¨tre
4. **RCX** â† QuatriÃ¨me paramÃ¨tre
5. **R8**  â† CinquiÃ¨me paramÃ¨tre
6. **R9**  â† SixiÃ¨me paramÃ¨tre

**ParamÃ¨tres suivants** : passÃ©s sur la pile (stack)

### ğŸ”„ Valeur de Retour
- **RAX** : Valeur de retour de la fonction

---

## ğŸ“ Exemple avec ft_strcpy

```c
char *ft_strcpy(char *dest, const char *src);
```

**Mapping des paramÃ¨tres :**
- `dest` (1er param) â†’ **RDI**
- `src` (2Ã¨me param) â†’ **RSI**
- **Retour** â†’ **RAX** (doit contenir l'adresse de dest)

**Votre code analysÃ© :**
```assembly
ft_strcpy:
    mov rcx, 0          ; rcx = compteur (index)
loop:
    mov al, [rsi + rcx] ; al = src[rcx] (lecture depuis RSI = src)
    mov [rdi + rcx], al ; dest[rcx] = al (Ã©criture vers RDI = dest)
    inc rcx             ; rcx++
    cmp al, 0           ; vÃ©rifier si caractÃ¨re nul
    je end
    jne loop
end:
    mov rax, rdi        ; retourner dest (RDI â†’ RAX)
    ret
```

---

## ğŸ—‚ï¸ Classification des Registres

### ğŸ”µ Registres 64-bit (Entiers)
| Registre | Usage | Sauvegarde | Description |
|----------|-------|------------|-------------|
| **RAX** | Valeur de retour | Non | Accumulateur |
| **RBX** | Usage gÃ©nÃ©ral | **Oui** | Base |
| **RCX** | 4e paramÃ¨tre | Non | Compteur |
| **RDX** | 3e paramÃ¨tre | Non | DonnÃ©es |
| **RSI** | 2e paramÃ¨tre | Non | Source Index |
| **RDI** | 1er paramÃ¨tre | Non | Destination Index |
| **RBP** | Base pointer | **Oui** | Frame pointer |
| **RSP** | Stack pointer | **Oui** | Pointeur de pile |
| **R8-R11** | ParamÃ¨tres/temp | Non | Usage gÃ©nÃ©ral |
| **R12-R15** | Usage gÃ©nÃ©ral | **Oui** | PrÃ©servÃ©s |

### ğŸ¨ Sous-registres (32/16/8 bits)

#### Exemple avec RAX :
```
RAX (64-bit) : [--------AAAAAAAA--------]
EAX (32-bit) :         [AAAAAAAA]
AX  (16-bit) :            [AAAA]
AH  (8-bit)  :            [AA--]  (High byte)
AL  (8-bit)  :            [--AA]  (Low byte)
```

#### Tous les registres :
| 64-bit | 32-bit | 16-bit | 8-bit (low) | 8-bit (high) |
|--------|--------|--------|-------------|--------------|
| RAX | EAX | AX | AL | AH |
| RBX | EBX | BX | BL | BH |
| RCX | ECX | CX | CL | CH |
| RDX | EDX | DX | DL | DH |
| RSI | ESI | SI | SIL | - |
| RDI | EDI | DI | DIL | - |
| RBP | EBP | BP | BPL | - |
| RSP | ESP | SP | SPL | - |

---

## ğŸ’¡ Choix des Registres - Guide Pratique

### ğŸ¯ Pour les Boucles
```assembly
; Compteur de boucle
mov rcx, 0          ; RCX idÃ©al pour les compteurs
loop:
    ; ... code ...
    inc rcx
    cmp rcx, limite
    jl loop
```

### ğŸ“ Pour Manipulation de CaractÃ¨res
```assembly
; Utiliser les registres 8-bit pour les caractÃ¨res
mov al, [rsi]       ; AL = caractÃ¨re (8 bits)
mov [rdi], al       ; Copier le caractÃ¨re
```

### ğŸ”„ Pour les Adresses
```assembly
; Utiliser les registres 64-bit pour les pointeurs
mov rax, rdi        ; Sauvegarder une adresse
lea rbx, [rdi + 8]  ; Calculer une nouvelle adresse
```

---

## ğŸ“š Exemples de Fonctions Courantes

### ft_strlen(const char *s)
```assembly
ft_strlen:
    ; s â†’ RDI
    mov rcx, 0          ; compteur
loop:
    cmp BYTE PTR [rdi + rcx], 0
    je end
    inc rcx
    jmp loop
end:
    mov rax, rcx        ; retour â†’ RAX
    ret
```

### ft_strcmp(const char *s1, const char *s2)
```assembly
ft_strcmp:
    ; s1 â†’ RDI, s2 â†’ RSI
    mov rcx, 0          ; index
loop:
    mov al, [rdi + rcx] ; s1[i]
    mov bl, [rsi + rcx] ; s2[i]
    cmp al, bl
    jne diff
    test al, al         ; vÃ©rifier fin de chaÃ®ne
    jz equal
    inc rcx
    jmp loop
diff:
    sub al, bl          ; diffÃ©rence
    movsx rax, al       ; Ã©tendre le signe
    ret
equal:
    xor rax, rax        ; retour 0
    ret
```

---

## âš ï¸ RÃ¨gles Importantes

### ğŸ›¡ï¸ Registres Ã  PrÃ©server
Si vous utilisez **RBX, RBP, R12-R15**, vous DEVEZ les sauvegarder :
```assembly
ma_fonction:
    push rbx            ; Sauvegarder
    ; ... utiliser rbx ...
    pop rbx             ; Restaurer
    ret
```

### ğŸš« Registres Temporaires
**RAX, RCX, RDX, RSI, RDI, R8-R11** peuvent Ãªtre modifiÃ©s librement.

### ğŸ“ Alignement de la Pile
La pile doit Ãªtre alignÃ©e sur 16 bytes avant un appel de fonction.

---

## ğŸª Astuces MnÃ©motechniques

- **RDI** = **D**estination **I**ndex â†’ Premier paramÃ¨tre (souvent destination)
- **RSI** = **S**ource **I**ndex â†’ DeuxiÃ¨me paramÃ¨tre (souvent source)
- **RAX** = **A**ccumulator â†’ Toujours la valeur de retour
- **RCX** = **C**ounter â†’ Parfait pour les compteurs de boucle
- **AL** = **A** **L**ow â†’ Pour manipuler des bytes (caractÃ¨res)

---

## ğŸ”§ Outils de Debugging

### VÃ©rifier les registres :
```bash
# Avec GDB
gdb ./votre_programme
(gdb) break ft_strcpy
(gdb) run
(gdb) info registers
```

### Afficher la mÃ©moire :
```bash
(gdb) x/s $rdi    # Afficher la chaÃ®ne pointÃ©e par RDI
(gdb) x/s $rsi    # Afficher la chaÃ®ne pointÃ©e par RSI
```
